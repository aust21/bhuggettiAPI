{% extends 'base.html' %}
<!--  -->

{% block title %} bhuggetti API | My dashbord {% endblock %}

<!--  -->
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='dash.css') }}" />
<link
  href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
  rel="stylesheet"
/>
<!-- My CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='cpanel.css') }}" />
<main>
  <section id="sidebar">
    <a href="#" class="brand">
      <i class="bx bx-happy-heart-eyes bx-spin"></i>
      <span class="text">bhuggetiAPI</span>
    </a>
    <ul class="side-menu top">
      <li class="active">
        <a href="#">
          <i class="bx bxs-dashboard"></i>
          <span class="text">Dashboard</span>
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('views.home', view='all') }}"
          class="{% if view == 'all' %}active{% endif %}"
        >
          <i class="bx bxs-user"></i>
          <span class="text">Submissions</span>
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('views.home', view='culture-fit') }}"
          class="{% if view == 'culture-fit' %}active{% endif %}"
        >
          <i class="bx bxs-doughnut-chart"></i>
          <span class="text">Culture Fit Questions</span>
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('views.home', view='technical') }}"
          class="{% if view == 'technical' %}active{% endif %}"
        >
          <i class="bx bxs-message-dots"></i>
          <span class="text">Technical Questions</span>
        </a>
      </li>
    </ul>
    <ul class="side-menu">
      <li>
        <a href="{{ url_for('auth.logout') }}" class="logout">
          <i class="bx bxs-log-out-circle"></i>
          <span class="text">Logout</span>
        </a>
      </li>
    </ul>
  </section>
  <!-- SIDEBAR -->

  <!-- CONTENT -->
  <section id="content">
    <!-- NAVBAR -->
    <nav>
      <i class="bx bx-menu"></i>
      <!-- <a href="#" class="nav-link">Categories</a> -->
      <form action="#">
        <div class="form-input">
          <input type="search" placeholder="Search..." />
          <button type="submit" class="search-btn">
            <i class="bx bx-search"></i>
          </button>
        </div>
      </form>
      <input type="checkbox" id="switch-mode" hidden />
      <label for="switch-mode" class="switch-mode"></label>
      <p>Hey {{user.name}}</p>
      <a href="#" class="profile">
        <img src="../static/img/me.jpeg" />
      </a>
    </nav>
    <!-- NAVBAR -->

    <!-- MAIN -->
    <main>
      <div class="head-title">
        <div class="left">
          <h1>Dashboard</h1>
        </div>
      </div>

      <ul class="box-info">
        <li>
          <i class="bx bxs-calendar-check"></i>
          <span class="text">
            <h3>{{all}}</h3>
            <p>Submissions</p>
          </span>
        </li>
        <li>
          <i class="bx bxs-hard-hat"></i>
          <span class="text">
            <h3>{{tech}}</h3>
            <p>Technical Questions</p>
          </span>
        </li>
        <li>
          <i class="bx bxs-group"></i>
          <span class="text">
            <h3>{{cult}}</h3>
            <p>Culture fit Questions</p>
          </span>
        </li>
      </ul>

      <div class="table-data">
        <div class="order">
          <div class="head">
            <h3>Recent Submissions</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th>Question</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for post in posts %}
              <tr>
                <td>
                  <span class="question">{{post.question}}</span>
                </td>
                <td class="date">
                  <a
                    href="{{ url_for('views.delete_post', id=post.id, field=post.field, view=view) }}"
                    ><i class="bx bxs-trash-alt"></i
                  ></a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="todo">
          <div class="head">
            <h3>Post a Question</h3>
            <i class="bx bx-plus"></i>
            <i class="bx bx-filter"></i>
          </div>
          <form
            id="questionForm"
            method="POST"
            action="{{ url_for('views.submit_question', view=view)}}"
          >
            <div class="q-entry">
              <label for="category">Question Type</label>
              <select name="category" id="category">
                <option value="none">Select</option>
                <option value="culture-fit">Culture Fit Question</option>
                <option value="technical">Technical Question</option>
              </select>
            </div>

            <div class="q-entry">
              <label for="field">Question Field</label>
              <select name="field" id="field">
                <option value="none">Select</option>
                <option value="Architecture">Architecture</option>
                <option value="Software ENG">Software Engineering</option>
                <option value="Business Management">Business Management</option>
                <option value="Mechanical Engineering">
                  Mechanical Engineering
                </option>
                <option value="Not Relevant">Not Relevant</option>
              </select>
            </div>

            <div class="q-entry">
              <label for="question">Question</label>
              <textarea name="question" id="question" required></textarea>
            </div>
            <button type="submit">Submit</button>
          </form>
        </div>
      </div>
    </main>
    <!-- MAIN -->
  </section>
  <!-- CONTENT -->

  <script>
    const allSideMenu = document.querySelectorAll(
      "#sidebar .side-menu.top li a"
    );

    allSideMenu.forEach((item) => {
      const li = item.parentElement;

      item.addEventListener("click", function () {
        allSideMenu.forEach((i) => {
          i.parentElement.classList.remove("active");
        });
        li.classList.add("active");
      });
    });

    // TOGGLE SIDEBAR
    const menuBar = document.querySelector("#content nav .bx.bx-menu");
    const sidebar = document.getElementById("sidebar");

    menuBar.addEventListener("click", function () {
      sidebar.classList.toggle("hide");
    });

    const searchButton = document.querySelector(
      "#content nav form .form-input button"
    );
    const searchButtonIcon = document.querySelector(
      "#content nav form .form-input button .bx"
    );
    const searchForm = document.querySelector("#content nav form");

    searchButton.addEventListener("click", function (e) {
      if (window.innerWidth < 576) {
        e.preventDefault();
        searchForm.classList.toggle("show");
        if (searchForm.classList.contains("show")) {
          searchButtonIcon.classList.replace("bx-search", "bx-x");
        } else {
          searchButtonIcon.classList.replace("bx-x", "bx-search");
        }
      }
    });

    if (window.innerWidth < 768) {
      sidebar.classList.add("hide");
    } else if (window.innerWidth > 576) {
      searchButtonIcon.classList.replace("bx-x", "bx-search");
      searchForm.classList.remove("show");
    }

    window.addEventListener("resize", function () {
      if (this.innerWidth > 576) {
        searchButtonIcon.classList.replace("bx-x", "bx-search");
        searchForm.classList.remove("show");
      }
    });

    const switchMode = document.getElementById("switch-mode");

    switchMode.addEventListener("change", function () {
      if (this.checked) {
        document.body.classList.add("dark");
      } else {
        document.body.classList.remove("dark");
      }
    });
  </script>

  <script>
    const select = document.getElementById("field");
    let options = Array.from(select.options);

    // Remove the "Select" option from sorting
    const selectOption = options.shift();

    // Sort options alphabetically by their text
    options.sort((a, b) => a.text.localeCompare(b.text));

    // Add the "Select" option back at the beginning
    options.unshift(selectOption);

    // Rebuild the select options
    select.innerHTML = "";
    options.forEach((option) => select.add(option));
  </script>
  {% endblock %}
</main>
